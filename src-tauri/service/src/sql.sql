SELECT products.id, products.name, products.description, products.image, products.price, products.min_quantity, (SELECT COALESCE(SUM(quantity), 0) FROM inventory_mouvements JOIN order_items ON order_items.inventory_id = inventory_mouvements.id WHERE order_items.product_id = products.id) - (SELECT COALESCE(SUM(quantity), 0) FROM inventory_mouvements JOIN invoice_items ON invoice_items.inventory_id = inventory_mouvements.id WHERE invoice_items.product_id = products.id) AS _stock FROM products ORDER BY created_at DESC;