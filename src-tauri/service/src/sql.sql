SELECT products.id, products.name, products.description, products.image, products.created_at, products.price, products.min_quantity, (SELECT COALESCE(SUM(quantity), ?) FROM inventory_mouvements JOIN order_items ON order_items.inventory_id = inventory_mouvements.id JOIN orders ON orders.id = order_items.order_id WHERE inventory_mouvements.product_id = products.id AND (invoices.status = ? OR invoices.status = ?)) - (SELECT COALESCE(SUM(quantity), ?) FROM inventory_mouvements JOIN invoice_items ON invoice_items.inventory_id = inventory_mouvements.id JOIN invoices ON invoices.id = invoice_items.invoice_id WHERE inventory_mouvements.product_id = products.id AND (invoices.status = ? OR invoices.status = ?)) AS stock FROM products WHERE products.name LIKE ? OR products.description LIKE ? ORDER BY created_at DESC LIMIT ? OFFSET ?